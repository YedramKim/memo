---
title: 언리얼-공부-4
date: 2020-04-19 14:11:53
tags:
---

## 콜리전 설정
- 언리얼 엔진에서 물리적 충돌 영역인 콜리전의 제작 방법은 크게 세가지 존재한다.
	1. 스태틱메시 에셋
		- 스태틱 메시의 스태틱 메시 에디터에서 콜리전 영역을 설정하는 방식.
	2. 기본 도형 컴포넌트
		- 구체, 박스, 캡슐의 기본 도형을 사용해 충돌 영역을 지정하는 방법. 스켈레탈 메시를 움직일 때 주로 사용한다.
	3. 피직스 애셋
		- 캐릭터의 각 부위에 기본 도형으로 충돌 영역을 설정하고 이를 연결해서 캐릭터의 물리를 설정하는 방법. 
		- 스켈레탈 메시에서만 사용할 수 있다.
- 언리얼 엔진에서 물리 설정은 크게 다음 세가지로 구분된다.
	1. 콜리전 채널과 기본 반응
	2. 콜리전 채널의 용도
	3. 다른 콜리전 채널과의 반응

### 콜리전 채널
- 충돌체에는 반드시 하나의 콜리전 채널을 설정해야하는데, 언리얼 엔진에서 제공하는 기본 콜리전 채널은 다음과 같다.
	1. WorldStatic: 움직이지 않는 정적인 배경 액터에 사용하는 채널. 주로 스태틱메시 액터에 있는 스태틱메시 컴포넌트에 사용한다.
	2. WorldDynamic: 움직이는 액터에 사용하는 채널. 블루프린트에 속한 스태틱 메시 컴포넌트에 사용.
	3. Pawn: 플레이어가 조종하는 물체에 주로 사용. 캐릭터의 충돌을 담당하는 캡슐 컴포넌트에 설정된다.
	4. Visibility: 배경 물체가 시작적으로 보이는지 탐지하는 데 사용. 탐지에서 폰은 제외된다. 마우스로 물체를 선택하는 피킹 기능을 구현할 때 사용한다.
	5. Camera: 카메라 설정을 위해 카메라와 목표물 간에 장애물이 있는지 탐지하는데 사용한다.
	6. PhysicsBody: 물리 시뮬레이션으로 움직이는 컴포넌트에 설정한다.
	- 그 외에 Vehicle, Destructible 등의 채널이 존재한다.
- 또한 프로젝트 세팅을 통해서 콜리전 채널을 만들 수가 있다. 콜리전 채널은 다시 오브젝트 채널과 트레이스 채널로 나뉜다.
	- 오브젝트 채널: 콜리전 영역에 지정하는 콜리전 채널 (Visibility, Camera를 제외한 채널들)
	- 트레이스 채널: 어떤 행동에 설정하는 콜리전 채널 (Visibility, Camera)
- 생성한 채널은 이후 프리셋을 생성한 뒤의 기존의 프리셋들과의 반응을 설정할 필요가 있다.

### 콜리전 프리셋
- 콜리전 채널과 콜리전 반응 값을 설정한 목록(?)
- 캐릭터의 캡슐 컴포넌트에서 콜리전 채널은 Collision 섹션의 콜리전 프리셋의 Object Type에서 확인할 수 있다.
- UPrimitiveComponent::SetCollisionProfileName을 통해서 콜리전 프리셋을 설정할 수 있다.
- 또한 Object Type 위에 위치한 Collision Enabled 항목을 통해서 해당 컴포넌트의 물리기능을 어떻게 사용할 지 지정할 수 있다.
	1. Query
		- 두 물체의 충돌 영역이 서로 겹치는지 테스트하는 설정이다.
		- 충돌 영역의 겹침을 감지하는 것은 언리얼 엔진에서 Overlap이라고 부르며, 오버랩 발생시에 관련 컴포넌트에 BeginOverlap 이벤트가 발생한다.
		- Raycast나 Sweep 기능도 Query에 속한다.
	2. Physics
		- 물리적인 시뮬레이션을 사용할 때 설정한다.
	3. Query and Physics
		- 위의 두 기능을 모두 사용하는 설정이다.

### 콜리전 반응값
- 또한 해당 컴포넌트에 설정된 컬리전 채널이 상대방 컴포넌트의 콜리전 채널과 어떻게 반응할지 지정하는 작업이 필요하다. 반응값은 3가지 있다.
	- 무시(Ignore): 콜리전이 있어도 아무 충돌이 일어나지 않는다.
	- 겹침(Overlap): 무시처럼 물체가 통과되지만 이벤트를 발생시킨다.
	- 블록(Block): 물체가 통과할 수 없도록 막는다.
- 언리얼 엔진에서 물리는 무시 반응을 최대화하고, 블록 반응을 최소화하도록 동작한다. 예를 들어서 충돌 컴포넌트 중 하나를 무시 반응으로 설정하면 겹침과 블록 반응은 발생하지 않는다.
- 두 컴포넌트 간에 물리적 반응이 일어날 때 각 컴포넌트에는 특별한 이벤트가 발생한다. 겹침 반응에는 BeginOverlap 이벤트가 발생하고, 블록 반응에는 Hit 이벤트가 발생한다.

### 트레이스 채널을 통한 충돌 검사
- 트레이스 채널을 사용해서 물리적 충돌 여부를 가리는 함수 중 하나로 UWorld::SweepSingleByChannel이 있다. 물리는 월드의 기능이므로 GetWorld() 함수를 사용해서 월드에게 명령을 내려야 한다.
	- 해당 함수는 기본 도형을 인자로 받은 후 시작 지점에서 끝지점까지 쓸면서 해당 영역 내에서 물리 판정이 일어났는지를 조사한다. 인자로 넣은 요소들은 다음과 같다.
		- HitResult: 충돌이 탐지된 경우 관련된 정보를 담을 구조체
		- Start: 탐색을 시작할 위치
		- End: 탐색을 끝낼 위치
		- Rot: 탐색에 사용할 도형의 회전
		- TraceChannel: 물리 충졸 감지에 사용할 트레이스 채널 정보
		- CollisionShape: 탐색에 사용할 기본 도형 정보. 구체, 캡슐, 박스를 사용한다.
		- Params: 탐색 방법에 대한 설정값을 모아둔 구조체
		- ResponseParams: 탐색 반응을 설정하기 위한 구조체
- 커스텀 콜리전 채널의 값은 언리얼 엔진에서 정의한 ECollisionChannel 열거형으로 가져올 수 있는데 C++에서 이를 가져오는 방법은 다소 복잡하다. 언리얼은 게임에서 활용할 수 있도록 총 32개의 채널을 제공하는데, 그 중 8개는 언리얼이 기본으로 사용하고, 여섯개는 엔진에서 다른 용도로 사용하도록 예약돼있다. 그래서 나머지 18개만 사용할 수 있다. 프로젝트에서 새로 생성하는 채널은 ECollisionChannel::ECC_GameTraceChannel(1~18)까지 중에서 하나를 배정받는다. 어떤 값을 배정받았는지는 프로젝트의 `Config/DefaultEngine.ini`에서 확인할 수 있다. (DefaultChannelResponses를 찾으면 된다.)

## 대미지 프레임 워크
- 언리얼 엔진에서는 대미지 프레임워크를 통해서 데미지에 관련된 여러 기능을 간편하게 처리할 수 있다.
- AActor::TakeDamage: 이 함수를 사용하면 손쉽게 액터에 대미지를 전달할 수 있다. TakeDamage 함수는 총 4개의 인자를 가지고 있다.
	1. DamageAmount: 전달할 대미지 세기
	2. DamageEvent: 대미지 종류
	3. EventInstigator: 공격 명령을 내린 가해자 (컨트롤러)
	4. DamageCauser: 대미지 전달을 위해 사용한 도구 (액터)
- 모든 액터의 설정에는 Can be Damaged 속성(C++에서는 `bCanBeDamaged`)이 있는데 이 속성의 체크를 해제하면 AActor::TakeDamage에 의해서 캐릭터에 전달된 대미지의 결과가 모두 0이 된다.


## 그외
- 핫 리로드 방식으로 컴파일을 진행하면 이미 레벨에 배치된 액터의 속성값은 컴파일로 변경된 값이 아닌 이전 코드의 값으로 유지가 된다. 언리얼 오브젝트의 기본값을 변경하는 경우 가급적 에디터를 종료하고 다시 시작하는 것을 권장한다.
- 언리얼 엔진에서는 `DrawDebugHelpers.h`를 통해서 디버그 드로잉 기능을 이용할 수 있다.
- AActor::SetActorEnableCollision(bool bNewActorEnableCollision): 콜리전을 활성화할지 정하는 함수